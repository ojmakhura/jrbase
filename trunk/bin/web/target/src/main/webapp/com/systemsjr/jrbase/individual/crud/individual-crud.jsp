<!-- Generated by pages/crud/manageable.jsp.vsl in cartridge andromda-bpm4struts -->
<%@ include file="/taglib-imports.jspf" %>
<tiles:insert definition="main.layout">

    <tiles:put name="title" type="string">
        <bean:message key="individual.page.title"/>
    </tiles:put>

    <tiles:put name="style" type="string">
        <link rel="stylesheet" type="text/css" media="screen" href="<html:rewrite page="/layout/default-manageable.css"/>"></link>
        <link rel="stylesheet" type="text/css" media="all" href="<html:rewrite page="/layout/default-calendar.css"/>"/>
    </tiles:put>

    <tiles:put name="javascript" type="string">
        <script type="text/javascript" src="<html:rewrite action="/calendar"/>"></script>
        <script type="text/javascript">
        //<!--
            function setSelect(multi, form, name, value)
            {
                var select = form.elements[name];
                var options = select.options;

                // for browser compatibility's sake we go through the options ourselves
                for (var i=0; i<options.length; i++)
                {
                    if (multi)
                    {
                        // Array.indexOf is defined in Javascript 1.5, not before
                        options[i].selected = arrayContainsElement(value,options[i].value);
                    }
                    else
                    {
                        if (options[i].value == value)
                        {
                            select.selectedIndex = i;
                            break;
                        }
                    }

                }
            }

            function arrayContainsElement(array, element)
            {
              var containsElement = false;
              for (var i=0; i<array.length && !containsElement; i++) containsElement = (array[i] == element);
              return containsElement;
            }

            function setAction(crud) { document.forms['manageIndividualForm'].elements['crud'].value = crud; }

            function enableUpdate(enabled) { document.getElementById("updateButton").disabled = !enabled; }

            var selectionCount = 0;

            function verifyEnableDelete(checkbox)
            {
                if (checkbox.checked) selectionCount++; else selectionCount--;
                document.getElementById("deleteButton").disabled = (selectionCount < 1);
            }

            function clearFields(form)
            {
                form.reset();
                enableUpdate(false);
                setFields("","","","","","","","","","","","","","","[]","","",form);
            }

            function setFields(individualId,idNumber,salutation,surname,firstName,middleNames,sex,postalAddress,physicalAddress,email,dob,idType,id,individual,nextOfKins,countryOfBirth,countryOfCitizenship,form)
            {
                form.elements["individualId"].value = individualId;
                form.elements["idNumber"].value = idNumber;
                setSelect(false,form,"salutation",salutation);
                form.elements["surname"].value = surname;
                form.elements["firstName"].value = firstName;
                form.elements["middleNames"].value = middleNames;
                setSelect(false,form,"sex",sex);
                form.elements["postalAddress"].value = postalAddress;
                form.elements["physicalAddress"].value = physicalAddress;
                form.elements["email"].value = email;
                form.elements["dobAsString"].value = dob;
                setSelect(false,form,"idType",idType);
                form.elements["id"].value = id;
                setSelect(false,form,"individual",individual);
                setSelect(true,form,"nextOfKins",nextOfKins.substring(1,nextOfKins.length-1).split(", "));
                setSelect(false,form,"countryOfBirth",countryOfBirth);
                setSelect(false,form,"countryOfCitizenship",countryOfCitizenship);
            }
        //-->
        </script>
    </tiles:put>

    <tiles:put name="body" type="string">

        <div>
            <h1><bean:message key="individual.page.title"/></h1>
        </div>

        <html:form styleId="manageIndividualForm" action="/Individual/Manage" method="post">
            <input type="hidden" name="crud" value=""/>
            <div id="criteria">
                <c:if test="${!empty manageableForm}">
                    <table>
                        <tr>
                            <td><nobr><bean:message key="individual.individual.id"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:text name="manageableForm" property="individualId" styleClass="criteriaField" styleId="individualId"/>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.id.number"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:text name="manageableForm" property="idNumber" styleClass="criteriaField" styleId="idNumber"/>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.salutation"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:select name="manageableForm" property="salutation">
                                    <option value=""><bean:message key="select.option.blank"/></option>
                                    <html:option value="MR">MR</html:option>
                                    <html:option value="MRS">MRS</html:option>
                                    <html:option value="MISS">MISS</html:option>
                                    <html:option value="PROFESSOR">PROFESSOR</html:option>
                                    <html:option value="DR">DR</html:option>
                                    <html:option value="MS">MS</html:option>
                                </html:select>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.surname"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:text name="manageableForm" property="surname" styleClass="criteriaField" styleId="surname"/>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.first.name"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:text name="manageableForm" property="firstName" styleClass="criteriaField" styleId="firstName"/>
                            </td>
                        </tr>
                        <tr>
                            <td><bean:message key="individual.middle.names"/></td>
                            <td>
                                <html:text name="manageableForm" property="middleNames" styleClass="criteriaField" styleId="middleNames"/>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.sex"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:select name="manageableForm" property="sex">
                                    <option value=""><bean:message key="select.option.blank"/></option>
                                    <html:option value="MALE">MALE</html:option>
                                    <html:option value="FEMALE">FEMALE</html:option>
                                </html:select>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.postal.address"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:textarea name="manageableForm" property="postalAddress" styleClass="criteriaField" styleId="postalAddress"/>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.physical.address"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:textarea name="manageableForm" property="physicalAddress" styleClass="criteriaField" styleId="physicalAddress"/>
                            </td>
                        </tr>
                        <tr>
                            <td><bean:message key="individual.email"/></td>
                            <td>
                                <html:text name="manageableForm" property="email" styleClass="criteriaField" styleId="email"/>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.dob"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:text name="manageableForm" property="dobAsString" styleClass="criteriaField" styleId="dob"/>
                                <html:img page="/layout/calendar/calendar.gif" styleId="dob_trigger" styleClass="calendar"/>
                                <script type="text/javascript">
                                //<!--
                                    Calendar.setup({
                                        inputField     :    "dob",
                                        ifFormat       :    "%m/%d/%Y",
                                        daFormat       :    "%m/%d/%Y",
                                        showsTime      :    false,
                                        button         :    "dob_trigger",
                                        singleClick    :    true
                                    });
                                //-->
                                </script>
                            </td>
                        </tr>
                        <tr>
                            <td><nobr><bean:message key="individual.id.type"/> <div class="important">*</div></nobr></td>
                            <td>
                                <html:select name="manageableForm" property="idType">
                                    <option value=""><bean:message key="select.option.blank"/></option>
                                    <html:option value="OMANG">OMANG</html:option>
                                    <html:option value="PASSPORT">PASSPORT</html:option>
                                    <html:option value="DRIVING LICENCE">LICENCE</html:option>
                                </html:select>
                            </td>
                        </tr>
                    <html:hidden name="manageableForm" property="id"/>
                        <tr>
                            <td>
                                    <html:link action="/Individual/Manage"><bean:message key="individual.individual"/></html:link>
                            </td>
                            <td>
                                <c:choose>
                                    <c:when test="${empty manageableForm.individualBackingList}">
                                        <select name="individual" disabled="disabled"/>
                                    </c:when>
                                    <c:otherwise>
                                        <select name="individual">
                                            <option value=""><bean:message key="select.option.blank"/></option>
                                            <c:forEach var="valueLabel" items="${manageableForm.individualBackingList}">
                                                <c:choose>
                                                    <c:when test="${valueLabel[0] eq manageableForm.individual}">
                                                        <option value="${valueLabel[0]}" selected="selected">${valueLabel[1]}</option>
                                                    </c:when>
                                                    <c:otherwise>
                                                        <option value="${valueLabel[0]}">${valueLabel[1]}</option>
                                                    </c:otherwise>
                                                </c:choose>
                                            </c:forEach>
                                        </select>
                                    </c:otherwise>
                                </c:choose>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                    <html:link action="/Individual/Manage"><bean:message key="individual.next.of.kins"/></html:link>
                            </td>
                            <td>
                                <c:choose>
                                    <c:when test="${empty manageableForm.nextOfKinsBackingList}">
                                        <select name="nextOfKins" disabled="disabled"/>
                                    </c:when>
                                    <c:otherwise>
                                        <select name="nextOfKins" multiple="multiple">
                                            <c:forEach var="valueLabel" items="${manageableForm.nextOfKinsBackingList}">
                        <option value="${valueLabel[0]}"<collections:contains item="${valueLabel}" array="${manageableForm.nextOfKins}"> selected="selected"</collections:contains>>${valueLabel[1]}</option>
                                            </c:forEach>
                                        </select>
                                    </c:otherwise>
                                </c:choose>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                    <nobr><html:link action="/Location/Manage"><bean:message key="individual.country.of.birth"/></html:link> <div class="important">*</div></nobr>
                            </td>
                            <td>
                                <c:choose>
                                    <c:when test="${empty manageableForm.countryOfBirthBackingList}">
                                        <select name="countryOfBirth" disabled="disabled"/>
                                    </c:when>
                                    <c:otherwise>
                                        <select name="countryOfBirth">
                                            <option value=""><bean:message key="select.option.blank"/></option>
                                            <c:forEach var="valueLabel" items="${manageableForm.countryOfBirthBackingList}">
                                                <c:choose>
                                                    <c:when test="${valueLabel[0] eq manageableForm.countryOfBirth}">
                                                        <option value="${valueLabel[0]}" selected="selected">${valueLabel[1]}</option>
                                                    </c:when>
                                                    <c:otherwise>
                                                        <option value="${valueLabel[0]}">${valueLabel[1]}</option>
                                                    </c:otherwise>
                                                </c:choose>
                                            </c:forEach>
                                        </select>
                                    </c:otherwise>
                                </c:choose>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                    <nobr><html:link action="/Location/Manage"><bean:message key="individual.country.of.citizenship"/></html:link> <div class="important">*</div></nobr>
                            </td>
                            <td>
                                <c:choose>
                                    <c:when test="${empty manageableForm.countryOfCitizenshipBackingList}">
                                        <select name="countryOfCitizenship" disabled="disabled"/>
                                    </c:when>
                                    <c:otherwise>
                                        <select name="countryOfCitizenship">
                                            <option value=""><bean:message key="select.option.blank"/></option>
                                            <c:forEach var="valueLabel" items="${manageableForm.countryOfCitizenshipBackingList}">
                                                <c:choose>
                                                    <c:when test="${valueLabel[0] eq manageableForm.countryOfCitizenship}">
                                                        <option value="${valueLabel[0]}" selected="selected">${valueLabel[1]}</option>
                                                    </c:when>
                                                    <c:otherwise>
                                                        <option value="${valueLabel[0]}">${valueLabel[1]}</option>
                                                    </c:otherwise>
                                                </c:choose>
                                            </c:forEach>
                                        </select>
                                    </c:otherwise>
                                </c:choose>
                            </td>
                        </tr>
                    </table>

                    <input type="submit" id="readButton" class="button" value="<bean:message key="button.read"/>" onclick="this.form.elements['id'].value='';setAction('read');"/>
                    <input type="submit" id="createButton" class="button" value="<bean:message key="button.create"/>" onclick="setAction('create');"/>
                    <input type="submit" id="deleteButton" class="button" value="<bean:message key="button.delete"/>" disabled="disabled" onclick="setAction('delete');"/>
                    <input type="submit" id="updateButton" class="button" value="<bean:message key="button.update"/>" disabled="disabled" onclick="setAction('update');return validateUpdate();"/>
                    <input type="button" id="clearButton" class="button" value="<bean:message key="button.clear"/>" onclick="clearFields(this.form);"/>
                </c:if>

<div id="entitySwitcher">
    <nobr>
        <bean:message key="select.other.entity"/>
        <select onchange="document.location=this.options[this.selectedIndex].value+'?ref_Individual='+this.form.elements['id'].value;">
            <option value="<html:rewrite page="/ClearanceLevel/Manage.do"/>"><bean:message key="clearance.level"/></option>
            <option value="<html:rewrite page="/Counter/Manage.do"/>"><bean:message key="counter"/></option>
            <option selected="selected" value="<html:rewrite page="/Individual/Manage.do"/>"><bean:message key="individual"/><bean:message key="referencing.entity.marker"/></option>
            <option value="<html:rewrite page="/Location/Manage.do"/>"><bean:message key="location"/><bean:message key="referencing.entity.marker"/></option>
            <option value="<html:rewrite page="/LocationType/Manage.do"/>"><bean:message key="location.type"/></option>
            <option value="<html:rewrite page="/LoginSession/Manage.do"/>"><bean:message key="login.session"/></option>
            <option value="<html:rewrite page="/Menu/Manage.do"/>"><bean:message key="menu"/></option>
            <option value="<html:rewrite page="/Organisation/Manage.do"/>"><bean:message key="organisation"/></option>
            <option value="<html:rewrite page="/OrganisationType/Manage.do"/>"><bean:message key="organisation.type"/></option>
            <option value="<html:rewrite page="/Program/Manage.do"/>"><bean:message key="program"/></option>
            <option value="<html:rewrite page="/Role/Manage.do"/>"><bean:message key="role"/></option>
            <option value="<html:rewrite page="/User/Manage.do"/>"><bean:message key="user"/></option>
            <option value="<html:rewrite page="/UserLocation/Manage.do"/>"><bean:message key="user.location"/></option>
        </select>
    </nobr>
</div>

            </div>

            <div id="manageableList" class="table">
                <c:if test="${!empty manageableForm.manageableList}">
                    <display:table name="${manageableForm.manageableList}" id="row" requestURI="${pageContext.request.requestURI}"
                            requestURIcontext="false"
                            export="true" pagesize="15" sort="list">
                        <display:column media="html" sortable="false">
                            <fmt:formatDate var="dobFormatted" value="${row.dob}" pattern="MM/dd/yyyy"/>
                            <nobr>
                                <input type="radio" name="_copy" onclick="enableUpdate(true);setFields('<formatting:escape language="javascript">${row.individualId}</formatting:escape>','<formatting:escape language="javascript">${row.idNumber}</formatting:escape>','<formatting:escape language="javascript">${row.salutation}</formatting:escape>','<formatting:escape language="javascript">${row.surname}</formatting:escape>','<formatting:escape language="javascript">${row.firstName}</formatting:escape>','<formatting:escape language="javascript">${row.middleNames}</formatting:escape>','<formatting:escape language="javascript">${row.sex}</formatting:escape>','<formatting:escape language="javascript">${row.postalAddress}</formatting:escape>','<formatting:escape language="javascript">${row.physicalAddress}</formatting:escape>','<formatting:escape language="javascript">${row.email}</formatting:escape>','<formatting:escape language="javascript">${dobFormatted}</formatting:escape>','<formatting:escape language="javascript">${row.idType}</formatting:escape>','<formatting:escape language="javascript">${row.id}</formatting:escape>','<formatting:escape language="javascript">${row.individual}</formatting:escape>','<formatting:escape language="javascript">${row.nextOfKins}</formatting:escape>','<formatting:escape language="javascript">${row.countryOfBirth}</formatting:escape>','<formatting:escape language="javascript">${row.countryOfCitizenship}</formatting:escape>',this.form);"/>
                                <input type="checkbox" name="selectedRows" value="${row.id}" onclick="verifyEnableDelete(this);"/>
                            </nobr>
                        </display:column>
                        <display:column media="xml csv excel pdf"
                            property="individualId"
                            titleKey="individual.individual.id"/>
                        <display:column media="html"
                            headerClass="individualId" paramId="individualId" maxLength="47"
                            sortProperty="individualId" sortable="true"
                            titleKey="individual.individual.id"><nobr><formatting:escape language="javascript,html">${row.individualId}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="idNumber"
                            titleKey="individual.id.number"/>
                        <display:column media="html"
                            headerClass="idNumber" paramId="idNumber" maxLength="47"
                            sortProperty="idNumber" sortable="true"
                            titleKey="individual.id.number"><nobr><formatting:escape language="javascript,html">${row.idNumber}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="salutation"
                            titleKey="individual.salutation"/>
                        <display:column media="html"
                            headerClass="salutation" paramId="salutation" maxLength="47"
                            sortProperty="salutation" sortable="true"
                            titleKey="individual.salutation"><nobr><formatting:escape language="javascript,html">${row.salutation}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="surname"
                            titleKey="individual.surname"/>
                        <display:column media="html"
                            headerClass="surname" paramId="surname" maxLength="47"
                            sortProperty="surname" sortable="true"
                            titleKey="individual.surname"><nobr><formatting:escape language="javascript,html">${row.surname}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="firstName"
                            titleKey="individual.first.name"/>
                        <display:column media="html"
                            headerClass="firstName" paramId="firstName" maxLength="47"
                            sortProperty="firstName" sortable="true"
                            titleKey="individual.first.name"><nobr><formatting:escape language="javascript,html">${row.firstName}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="middleNames"
                            titleKey="individual.middle.names"/>
                        <display:column media="html"
                            headerClass="middleNames" paramId="middleNames" maxLength="47"
                            sortProperty="middleNames" sortable="true"
                            titleKey="individual.middle.names"><nobr><formatting:escape language="javascript,html">${row.middleNames}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="sex"
                            titleKey="individual.sex"/>
                        <display:column media="html"
                            headerClass="sex" paramId="sex" maxLength="47"
                            sortProperty="sex" sortable="true"
                            titleKey="individual.sex"><nobr><formatting:escape language="javascript,html">${row.sex}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="postalAddress"
                            titleKey="individual.postal.address"/>
                        <display:column media="html"
                            headerClass="postalAddress" paramId="postalAddress" maxLength="47"
                            sortProperty="postalAddress" sortable="true"
                            titleKey="individual.postal.address"><nobr><formatting:escape language="javascript,html">${row.postalAddress}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="physicalAddress"
                            titleKey="individual.physical.address"/>
                        <display:column media="html"
                            headerClass="physicalAddress" paramId="physicalAddress" maxLength="47"
                            sortProperty="physicalAddress" sortable="true"
                            titleKey="individual.physical.address"><nobr><formatting:escape language="javascript,html">${row.physicalAddress}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="email"
                            titleKey="individual.email"/>
                        <display:column media="html"
                            headerClass="email" paramId="email" maxLength="47"
                            sortProperty="email" sortable="true"
                            titleKey="individual.email"><nobr><formatting:escape language="javascript,html">${row.email}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf" titleKey="individual.dob">${dobFormatted}</display:column>
                        <display:column media="html"
                            headerClass="dob" paramId="dob" maxLength="47"
                            sortProperty="dob" sortable="true"
                            titleKey="individual.dob"><nobr>${dobFormatted}</nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="idType"
                            titleKey="individual.id.type"/>
                        <display:column media="html"
                            headerClass="idType" paramId="idType" maxLength="47"
                            sortProperty="idType" sortable="true"
                            titleKey="individual.id.type"><nobr><formatting:escape language="javascript,html">${row.idType}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="individualLabel"
                            titleKey="individual.individual"/>
                        <display:column media="html"
                            headerClass="individual" paramId="individual" maxLength="47"
                            sortProperty="individualLabel" sortable="true"
                            titleKey="individual.individual"><nobr><formatting:escape language="javascript,html">${row.individualLabel}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="nextOfKinsLabels"
                            titleKey="individual.next.of.kins"/>
                        <display:column media="html"
                            headerClass="nextOfKins" paramId="nextOfKins" maxLength="47"
                            sortProperty="nextOfKinsLabels" sortable="true"
                            titleKey="individual.next.of.kins"><nobr><formatting:escape language="javascript,html">${row.nextOfKinsLabels}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="countryOfBirthLabel"
                            titleKey="individual.country.of.birth"/>
                        <display:column media="html"
                            headerClass="countryOfBirth" paramId="countryOfBirth" maxLength="47"
                            sortProperty="countryOfBirthLabel" sortable="true"
                            titleKey="individual.country.of.birth"><nobr><formatting:escape language="javascript,html">${row.countryOfBirthLabel}</formatting:escape></nobr></display:column>
                        <display:column media="xml csv excel pdf"
                            property="countryOfCitizenshipLabel"
                            titleKey="individual.country.of.citizenship"/>
                        <display:column media="html"
                            headerClass="countryOfCitizenship" paramId="countryOfCitizenship" maxLength="47"
                            sortProperty="countryOfCitizenshipLabel" sortable="true"
                            titleKey="individual.country.of.citizenship"><nobr><formatting:escape language="javascript,html">${row.countryOfCitizenshipLabel}</formatting:escape></nobr></display:column>
                    </display:table>
                </c:if>
            </div>

        </html:form>

        <div id="pageHelpSection">
            <blockquote>
                <a href="" id="pageHelp" style="display:inline;" onclick="openWindow('<html:rewrite action="/Individual/ManageHelp"/>','onlinehelp',true,false,760,540); return false;">
                    <bean:message key="online.help.href"/>
                </a>
                <html:img page="/layout/help.gif" style="display:inline;"/>
            </blockquote>
        </div>

    </tiles:put>

</tiles:insert>

